---
config:
  theme: neo
---
graph TD
    A[开始] --> B{检查命令行参数};
    B -- 参数不等于2 --> C[打印用法说明并退出];
    B -- 参数等于2 --> D[以二进制模式打开文件];
    D --> E{文件是否成功打开?};
    E -- 否 --> F[打印错误信息并退出];
    E -- 是 --> G[读取文件所有内容到缓冲区];
    G --> H[关闭文件];
    H --> I[初始化位置 pos = 0, 帧计数 frameCount = 0];
    I --> J{pos + 8 <= 文件总大小?};
    J -- 否 --> X[循环结束];
    J -- 是 --> K[从 pos 开始查找前导码];
    K --> L{是否找到前导码?};
    L -- 否 --> X;
    L -- 是 --> M[记录帧开始位置, 计算数据负载开始位置];
    M --> N{剩余数据是否足够一个最小帧?（头部+FCS）};
    N -- 否 --> X;
    N -- 是 --> O[查找下一个前导码的位置];
    O --> P[确定当前帧的FCS（CRC）位置];
    P --> Q{帧边界是否合法?};
    Q -- 否 --> J;
    Q -- 是 --> R[计算数据字段长度];
    R --> S{数据字段长度是否在 46-1500 字节之间?};
    S --> T[读取文件中的FCS值];
    T --> U[计算从目的MAC到数据末尾的CRC8值];
    U --> V[输出帧序号、头部信息（前导码/SFD/MAC/类型）];
    V --> W[输出数据字段长度和ASCII预览];
    S -- 否 --> V_ERR[标记长度异常];
    V_ERR --> W;
    W --> W2[输出文件中的FCS和计算出的CRC];
    W2 --> Y{计算的CRC == 文件中的FCS 并且 长度正常?};
    Y -- 是 --> Z[输出状态: Accept];
    Y -- 否 --> AA[输出状态: Reject];
    Z --> BB[更新 pos 到下一个前导码位置];
    AA --> BB;
    BB --> J;
    X --> CC{帧计数是否为 0?};
    CC -- 是 --> DD[打印 “未检测到有效以太网帧”];
    CC -- 否 --> EE[结束];
    C --> EE;
    F --> EE;
    DD --> EE;
