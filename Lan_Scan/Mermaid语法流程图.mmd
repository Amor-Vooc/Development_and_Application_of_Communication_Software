---
config:
  theme: neo
  layout: dagre
---
flowchart TB
 subgraph s1["多线程ARP扫描"]
    direction LR
        Q2{"原子地获取一个待扫描的IP索引"}
        Q1("工作线程")
        Q3["向目标IP发送ARP请求"]
        Q4("线程结束")
        Q5{"ARP请求成功且MAC有效?"}
        Q6["使用互斥锁保护输出"]
        Q7["打印 IP -> MAC 映射"]
  end
    A["开始"] --> B{"初始化 Winsock"}
    B -- 成功 --> C{"获取网络适配器信息大小"}
    B -- 失败 --> B_ERR["打印错误并退出"]
    C -- 成功 --> D["分配足够大的缓冲区"]
    C -- 失败 --> C_ERR["打印错误并退出"]
    D --> E{"用分配的缓冲区获取适配器详细信息"}
    E -- 成功 --> F["开始遍历网络适配器列表"]
    E -- 失败 --> E_ERR["打印错误并退出"]
    F --> G{"还有未处理的适配器?"}
    G -- 是 --> H["打印适配器名称、描述和MAC地址"]
    G -- 否 --> Z["清理 Winsock"]
    H --> I["开始遍历当前适配器的IP地址列表"]
    I --> J{"还有未处理的IP地址?"}
    J -- 是 --> K{"IP地址是否有效?（非0.0.0.0）"}
    J -- 否 --> F
    K -- 是 --> L["根据IP和掩码计算子网范围"]
    K -- 否 --> I
    L --> M{"子网主机数量是否过多?（>65534）"}
    M -- 否 --> N["创建该子网内所有主机的IP地址列表"]
    M -- 是 --> O["打印子网过大提示, 跳过扫描"]
    O --> I
    N --> P["设置多线程参数（线程数/原子索引/互斥锁）"]
    P --> Q["创建并启动多个工作线程"]
    Q1 --> Q2
    Q2 -- 还有IP --> Q3
    Q2 -- 没有IP了 --> Q4
    Q3 --> Q5
    Q5 -- 是 --> Q6
    Q6 --> Q7
    Q5 -- 否 --> Q2
    Q7 --> Q2
    Q --> R["主线程等待所有工作线程完成"]
    R --> I
    Z --> AA["结束"]
